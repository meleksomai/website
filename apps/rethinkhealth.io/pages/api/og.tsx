import { ImageResponse } from "@vercel/og";
import { NextRequest } from "next/server";
import React from "react";

export const config = {
  runtime: "experimental-edge",
};

export default function handler(req: NextRequest) {
  try {
    const { searchParams } = new URL(req.url);

    // dynamic params
    const title = searchParams.has("title")
      ? searchParams.get("title")?.slice(0, 100)
      : "Leveraging clinical engineering, product design, and data science, to improve patient care.";

    return new ImageResponse(
      (
        <div
          style={{
            backgroundColor: "#0020F5",
          }}
          tw="h-full w-full flex items-start justify-start"
        >
          <div tw="flex items-start justify-start h-full">
            <div tw="flex flex-col justify-between w-full h-full p-20">
              {/* Replace with your own logo */}
              <svg
                width="452"
                height="46"
                viewBox="0 0 2278 231"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <g clip-path="url(#clip0_103_39)">
                  <rect x="101" width="156" height="100" rx="20" fill="white" />
                  <rect
                    x="100"
                    y="98"
                    width="133"
                    height="100"
                    rx="20"
                    transform="rotate(90 100 98)"
                    fill="white"
                  />
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M76 99.9952L76 125L100.005 125C100.271 111.148 111.584 100 125.5 100C125.667 100 125.834 100.002 126 100.005L126 75L100.995 75C100.732 88.6862 89.6862 99.732 76 99.9952Z"
                    fill="white"
                  />
                  <path
                    d="M281.944 11.928H358.156C371.783 11.928 383.852 14.7507 394.364 20.396C405.071 26.0413 413.344 33.9253 419.184 44.048C425.024 53.976 427.944 65.2667 427.944 77.92C427.944 91.352 423.661 103.324 415.096 113.836C406.725 124.153 396.116 131.648 383.268 136.32L382.976 138.364L439.04 218.664V221H393.78L339.76 142.452H321.364V221H281.944V11.928ZM357.864 106.244C366.819 106.244 374.119 103.519 379.764 98.068C385.409 92.6173 388.232 85.7067 388.232 77.336C388.232 69.3547 385.507 62.5413 380.056 56.896C374.8 51.2507 367.597 48.428 358.448 48.428H321.364V106.244H357.864ZM528.691 225.672C513.896 225.672 500.562 222.265 488.687 215.452C476.812 208.639 467.468 199.295 460.655 187.42C454.036 175.351 450.727 161.821 450.727 146.832C450.727 132.621 454.036 119.481 460.655 107.412C467.274 95.148 476.423 85.4147 488.103 78.212C499.783 71.0093 512.826 67.408 527.231 67.408C542.61 67.408 555.847 70.7173 566.943 77.336C578.039 83.9547 586.41 93.0067 592.055 104.492C597.895 115.977 600.815 128.728 600.815 142.744C600.815 147.221 600.523 151.504 599.939 155.592H488.103C490.05 167.467 494.722 176.519 502.119 182.748C509.711 188.783 518.763 191.8 529.275 191.8C538.035 191.8 545.53 189.951 551.759 186.252C558.183 182.359 563.244 177.2 566.943 170.776L597.895 185.96C582.711 212.435 559.643 225.672 528.691 225.672ZM564.023 128.436C563.634 123.764 561.882 119.189 558.767 114.712C555.847 110.04 551.662 106.244 546.211 103.324C540.955 100.209 534.726 98.652 527.523 98.652C518.374 98.652 510.49 101.377 503.871 106.828C497.447 112.084 492.775 119.287 489.855 128.436H564.023ZM690.828 223.336C683.431 223.336 676.618 222.265 670.388 220.124C664.159 217.788 659.098 214.673 655.204 210.78C646.055 202.02 641.48 189.561 641.48 173.404V104.784H615.492V72.08H641.48V30.032H679.732V72.08H716.232V104.784H679.732V166.396C679.732 173.988 681.387 179.439 684.696 182.748C687.422 185.863 692.094 187.42 698.712 187.42C702.411 187.42 705.428 186.933 707.764 185.96C710.295 184.987 713.507 183.332 717.4 180.996V218.372C709.03 221.681 700.172 223.336 690.828 223.336ZM749.477 11.928H787.729V64.78L785.393 90.768H787.729C792.012 83.76 798.241 78.1147 806.417 73.832C814.593 69.5493 823.45 67.408 832.989 67.408C851.093 67.408 864.914 72.8587 874.453 83.76C884.186 94.4667 889.053 109.359 889.053 128.436V221H850.801V133.108C850.801 123.569 848.173 116.172 842.917 110.916C837.856 105.66 831.042 103.032 822.477 103.032C812.354 103.032 803.984 107.12 797.365 115.296C790.941 123.472 787.729 133.497 787.729 145.372V221H749.477V11.928ZM946.741 55.728C939.928 55.728 934.088 53.2947 929.221 48.428C924.355 43.5613 921.921 37.7213 921.921 30.908C921.921 24.0947 924.355 18.352 929.221 13.68C934.088 8.81333 939.928 6.38 946.741 6.38C953.555 6.38 959.297 8.81333 963.969 13.68C968.836 18.352 971.269 24.0947 971.269 30.908C971.269 37.7213 968.836 43.5613 963.969 48.428C959.297 53.2947 953.555 55.728 946.741 55.728ZM927.469 72.08H965.721V221H927.469V72.08ZM1005.83 72.08H1041.75V90.768H1044.08C1048.56 83.5653 1054.89 77.92 1063.06 73.832C1071.24 69.5493 1080.1 67.408 1089.64 67.408C1107.55 67.408 1121.17 72.8587 1130.52 83.76C1139.86 94.6613 1144.53 109.553 1144.53 128.436V221H1106.28V133.108C1106.28 123.569 1103.85 116.172 1098.98 110.916C1094.11 105.66 1087.3 103.032 1078.54 103.032C1068.22 103.032 1059.85 107.023 1053.43 115.004C1047.2 122.985 1044.08 133.011 1044.08 145.08V221H1005.83V72.08ZM1180.63 11.928H1218.89V125.808H1220.93L1274.37 72.08H1321.38V74.416L1265.02 129.604L1324.01 218.664V221H1278.75L1238.16 155.884L1218.89 174.864V221H1180.63V11.928ZM1348.41 11.928H1372.94V102.448H1480.98V11.928H1505.51V221H1480.98V125.808H1372.94V221H1348.41V11.928ZM1613.62 225.672C1599.41 225.672 1586.66 222.265 1575.37 215.452C1564.08 208.639 1555.22 199.295 1548.8 187.42C1542.57 175.351 1539.45 161.821 1539.45 146.832C1539.45 132.427 1542.37 119.189 1548.21 107.12C1554.25 95.0507 1562.72 85.4147 1573.62 78.212C1584.52 71.0093 1597.17 67.408 1611.58 67.408C1626.18 67.408 1638.83 70.7173 1649.54 77.336C1660.24 83.76 1668.42 92.7147 1674.07 104.2C1679.91 115.685 1682.83 128.825 1682.83 143.62C1682.83 146.54 1682.53 149.071 1681.95 151.212H1564.27C1564.86 162.503 1567.58 172.041 1572.45 179.828C1577.32 187.615 1583.45 193.455 1590.85 197.348C1598.44 201.241 1606.32 203.188 1614.5 203.188C1633.57 203.188 1648.27 194.233 1658.59 176.324L1679.61 186.544C1673.19 198.613 1664.43 208.152 1653.33 215.16C1642.43 222.168 1629.19 225.672 1613.62 225.672ZM1656.55 130.772C1656.16 124.543 1654.4 118.313 1651.29 112.084C1648.17 105.855 1643.21 100.599 1636.4 96.316C1629.78 92.0333 1621.41 89.892 1611.29 89.892C1599.61 89.892 1589.68 93.688 1581.5 101.28C1573.52 108.677 1568.26 118.508 1565.73 130.772H1656.55ZM1760.89 225.672C1749.99 225.672 1740.26 223.531 1731.69 219.248C1723.13 214.965 1716.51 209.125 1711.84 201.728C1707.17 194.136 1704.83 185.571 1704.83 176.032C1704.83 160.264 1710.77 148 1722.64 139.24C1734.52 130.285 1749.51 125.808 1767.61 125.808C1776.57 125.808 1784.84 126.781 1792.43 128.728C1800.22 130.675 1806.15 132.913 1810.24 135.444V126.392C1810.24 115.296 1806.35 106.439 1798.56 99.82C1790.78 93.0067 1780.95 89.6 1769.07 89.6C1760.7 89.6 1753.01 91.4493 1746 95.148C1738.99 98.652 1733.45 103.616 1729.36 110.04L1710.67 96.024C1716.51 87.0693 1724.49 80.0613 1734.61 75C1744.93 69.9387 1756.32 67.408 1768.78 67.408C1789.02 67.408 1804.89 72.7613 1816.37 83.468C1828.05 93.98 1833.89 108.385 1833.89 126.684V221H1810.24V199.684H1809.07C1804.79 206.887 1798.37 213.019 1789.8 218.08C1781.24 223.141 1771.6 225.672 1760.89 225.672ZM1763.23 203.772C1771.6 203.772 1779.39 201.631 1786.59 197.348C1793.79 193.065 1799.54 187.323 1803.82 180.12C1808.1 172.917 1810.24 165.033 1810.24 156.468C1805.57 153.353 1799.83 150.823 1793.01 148.876C1786.2 146.929 1779 145.956 1771.41 145.956C1757.78 145.956 1747.46 148.779 1740.45 154.424C1733.64 160.069 1730.23 167.369 1730.23 176.324C1730.23 184.5 1733.35 191.119 1739.58 196.18C1745.81 201.241 1753.69 203.772 1763.23 203.772ZM1868.42 11.928H1893.24V221H1868.42V11.928ZM1988.67 223.336C1982.64 223.336 1976.99 222.363 1971.74 220.416C1966.68 218.469 1962.39 215.841 1958.89 212.532C1955 208.833 1952.08 204.551 1950.13 199.684C1948.18 194.817 1947.21 188.88 1947.21 181.872V94.564H1921.22V72.08H1947.21V30.032H1972.03V72.08H2008.24V94.564H1972.03V175.74C1972.03 183.916 1973.59 189.951 1976.7 193.844C1980.4 198.127 1985.75 200.268 1992.76 200.268C1998.41 200.268 2003.86 198.613 2009.11 195.304V219.54C2006.19 220.903 2003.18 221.876 2000.06 222.46C1997.14 223.044 1993.35 223.336 1988.67 223.336ZM2039.8 11.928H2064.62V73.54L2063.45 93.98H2064.62C2068.71 86.388 2075.13 80.0613 2083.89 75C2092.85 69.9387 2102.58 67.408 2113.09 67.408C2131.2 67.408 2145.02 72.7613 2154.56 83.468C2164.1 93.98 2168.87 107.996 2168.87 125.516V221H2144.05V129.312C2144.05 115.88 2140.64 105.952 2133.83 99.528C2127.01 93.104 2118.16 89.892 2107.25 89.892C2099.47 89.892 2092.26 92.228 2085.65 96.9C2079.22 101.572 2074.06 107.607 2070.17 115.004C2066.47 122.401 2064.62 130.091 2064.62 138.072V221H2039.8V11.928Z"
                    fill="white"
                  />
                </g>
                <defs>
                  <clipPath id="clip0_103_39">
                    <rect width="2278" height="231" fill="white" />
                  </clipPath>
                </defs>
              </svg>

              <h1 tw="text-[60px] text-white font-bold text-left">{title}</h1>
            </div>
          </div>
        </div>
      ),
      {
        width: 1200,
        height: 627,
      }
    );
  } catch (e: any) {
    console.log(`${e.message}`);
    return new Response(`Failed to generate the image`, {
      status: 500,
    });
  }
}
